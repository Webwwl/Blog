(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{339:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"什么是同源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是同源"}},[t._v("#")]),t._v(" 什么是同源")]),t._v(" "),a("p",[t._v("浏览器规定: "),a("code",[t._v("协议")]),t._v("、"),a("code",[t._v("域名")]),t._v("、"),a("code",[t._v("端口")]),t._v("都相同属于同源，以下情况都不是同源：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("https://www.baidu.com")]),t._v(" vs "),a("code",[t._v("http://www.baidu.com")])]),t._v(" "),a("li",[a("code",[t._v("https://www.baidu.com")]),t._v(" vs "),a("code",[t._v("https://mail.baidu.com")])]),t._v(" "),a("li",[a("code",[t._v("http://www.baidu.com")]),t._v("   vs "),a("code",[t._v("http://www.baidu.com:8088")])])]),t._v(" "),a("h3",{attrs:{id:"跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),a("p",[t._v("当在"),a("code",[t._v("www.a.com")]),t._v("发出"),a("code",[t._v("www.b.com/xxx")]),t._v("的ajax请求时，即发生了跨域请求，根据浏览器的安全策略这个请求会被block.")]),t._v(" "),a("h3",{attrs:{id:"解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[t._v("#")]),t._v(" 解决方法")]),t._v(" "),a("p",[t._v("常用的解决方法：")]),t._v(" "),a("ul",[a("li",[t._v("jsonp")]),t._v(" "),a("li",[t._v("cors")]),t._v(" "),a("li",[t._v("请求转发")])]),t._v(" "),a("h4",{attrs:{id:"jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[t._v("#")]),t._v(" jsonp")]),t._v(" "),a("p",[t._v("浏览器允许"),a("code",[t._v("script")]),t._v("标签加载非同源的脚本，加载完毕即可执行，jsonp就是依托这个特性实现跨越请求： 先在客户端定义好处理数据的回调函数，由服务端返回脚本内容（填入服务端数据执行回调函数 ）。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 客户端")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clientCb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get data from server:::'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// script")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.xxx.com/xxx?cb=clientCb"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务端返回的脚本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'clientCb(\"data from server\")'")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("缺点： 只支持get类型的跨域请求")])]),t._v(" "),a("h4",{attrs:{id:"cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" cors")]),t._v(" "),a("p",[t._v("浏览器在发出cors的请求时会先有一次"),a("code",[t._v("预检")]),t._v("请求，类型是"),a("code",[t._v("options")]),t._v("，关键的http头信息有：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Origin: http://www.xxx.com            // 客户端的origin\nAccess-Control-Request-Method: PUT    // cors请求类型\n")])])]),a("p",[t._v("需要后端配合，在响应头加上以下字段")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Access-Control-Allow-Origin: http://www.xxx.com  // 设置允许跨域请求的域\nAccess-Control-Allow-Methods: GET, POST, PUT     // 设置允许跨域的请求类型\n")])])]),a("p",[t._v("如果cors请求满足服务端设置的限制即可正常请求，实现跨域。")]),t._v(" "),a("blockquote",[a("p",[t._v("支持get、post、put多种类型的请求")])]),t._v(" "),a("h4",{attrs:{id:"请求转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求转发"}},[t._v("#")]),t._v(" 请求转发")]),t._v(" "),a("p",[t._v("跨域请求限制只存在浏览器中，服务端之间的请求没有限制。前端请求同源接口，由后台server转发该请求至目标接口，响应内容原样转发给客户端即可完成跨域请求。")]),t._v(" "),a("ul",[a("li",[t._v("本地开发时，需要配置代理规则，实际上就是通过本地的node服务转发请求，以vue-cli为例：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("devServer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  proxy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      target"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.xxx.com'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目标地址")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 其他配置")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("部署打包后的静态文件，如果有跨域请求可通过nginx转发")])]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxy_pass  http://www.xxx.com/;  带/的话转发请求不带/api")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);